{% extends "base.html.twig" %}

{% block meta %}
    {{ parent() }}
    <meta name="robots" content="index, follow"/>
    <meta name="title" content="{{ title }}"/>
    <meta name="keywords"
          content="медицинское страхование отзывы, бесплатное лечение, бесплатная медицинская помощь, рейтинг медицинских страховых компаний омс в москве"/>
    <meta name="description" content="{{ title }}"/>
{% endblock %}

{% block title %}{{ title|raw }}{% endblock %}

{% block stylesheets %}
    <link href="/local/templates/kdteam/pages/feedback/main.min.css?158626847510518" type="text/css" rel="stylesheet"/>
    {% if pagination.page > 1 %}
        <link rel="canonical" href="{{ url('app_insurancecompany_feedback_index') }}">
    {% endif %}
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    <script type="text/javascript" src="/local/templates/kdteam/js/main.min.js?1593497507172695"></script>
    <script type="text/javascript" src="/local/templates/kdteam/pages/feedback/main.min.js?15862684754547"></script>
    <script type="text/javascript" src="/local/templates/kdteam/js/readmore.min.js?1586268475879"></script>
    {{ parent() }}
{% endblock %}


{% block main %}

    <!-- Breadcrumbs -->
    <ul class="breadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList">

        {% if is_mobile() or is_tablet() %}
            <li class="active-breadcrumbs" itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
                <a href="/" class="" itemprop="item">Главная
                    <meta itemprop="name" content="Главная">
                    <meta property="position" content="1">
                </a>
            </li>
        {% else %}
            <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
                <a href="/" itemprop="item">Главная
                    <meta itemprop="name" content="Главная">
                    <meta property="position" content="1">
                </a>
            </li>
            <li class="active-breadcrumbs" itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
                <a itemprop="item">Отзывы
                    <meta itemprop="name" content="Отзывы">
                    <meta property="position" content="2">
                </a>
            </li>
        {% endif %}
    </ul>

    <!-- Pages Title -->
    <h1 class="page-title">{{ title|raw }}</h1>

    <!-- ALL STEPS IN FORM -->
    <form action="" class="white_block">

        <!-- Add and All feedback btns -->
        <div class="feedback__btns">
            <a href="{{ path('app_insurancecompany_feedback_new') }}" class="whiteBtn">Добавить отзыв</a>
            <a href="{{ path('app_insurancecompany_feedback_index') }}" class="accentBtnBorder">Все отзывы</a>
            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ urlBuilder.buildUrl({ filter: { moderation: 0 }}) }}" class="accentBtnBorder">Модерация
                    отзывов</a>
            {% endif %}
        </div>

        <div class="feedback__filter">
            {{ form_row(filterForm.company) }}
            {{ form_row(filterForm.rating) }}
            {{ form_row(filterForm.region) }}

            <a class="feedback__filter__reset" href="{{ path('app_insurancecompany_feedback_index') }}">Сбросить
                фильтры</a>
        </div>

    </form>

    <!-- Wrap -->
    <div class="feedback">
    <div class="feedback__wrap_white-blocks">
    <!-- FeedBack block -->

    {% if nbReviews == 0 %}
        <div>
            <p class="error title-medium">Отзывы не найдены</p>
        </div>
    {% else %}
        {% if app.request.get('_route') == 'company_review_list' %}
            {% set company = reviews[0].company ? reviews[0].company : null %}
            <div itemprop="aggregateRating" itemtype="http://schema.org/AggregateRating" itemscope="">
                <meta itemprop="ratingValue"
                      content="{{ company ? (company.valuation) : '' }}">
                <meta itemprop="ratingCount"
                      content="{{ company ? (company.getFeedbacksCount()) : '' }}">
                <div itemprop="itemReviewed" itemscope itemtype="https://schema.org/Organization">
                    <meta itemprop="name" content="{{ company.name }}"/>
                </div>
            </div>
        {% endif %}
        {% for review in reviews %}
            {% include "InsuranceCompany/Review/_review_block.html.twig"  %}
        {% endfor %}

        {% include "InsuranceCompany/Review/_pagination.html.twig" %}

        </div>


        {% if nbReviews %}
            <div class="sidebar">
                <!-- First Sidebar block -->
                <div class="white_block">

                    <h3 class="sidebar__item_title">Рейтинг страховых
                        компаний{% if filter.region %} ({{ filter.region.name }}){% endif %}</h3>

                    <ul class="sidebar__item_lists scrollbar">
                        {% for i, company in companyRating %}
                            <li class="sidebar__item_lists_list list_numbered-items">
                                <span class="sidebar_count number">{{ i+1 }}</span>
                                <a href="{{ urlBuilder.buildUrl({ filter: { company: company[0].id } }) }}"
                                   class="sidebar__item_lists_list_link" id="company"
                                   data-amount-star="{{ company.actualRating }}"
                                   data-id="{{ company[0].id }}">{{ company[0].name }}</a>
                                <span class="sidebar_count rating">{{ company.actualRating | trim_number }}</span>
                            </li>
                        {% endfor %}
                    </ul>

                    <div class="center__child">
                        <a class="mainBtn" href="{{ path('app_insurancecompany_feedback_index') }}">Весь рейтинг</a>
                    </div>
                </div>


            </div>
        {% endif %}
        </div>
    {% endif %}
    <div class="info_block white_block">
        <p>Если у вас есть опыт обращения к своему страховому представителю, опишите его, вне зависимости от того,<br>
            положительный он или отрицательный. Так вы внесете свой вклад в формирование рейтинга страховых компаний<br>
            и возможно именно ваш отзыв станет решающим для посетителей сайта при выборе страховой компании. </p>
    </div>
    <!-- Second Sidebar block -->
{% endblock %}
