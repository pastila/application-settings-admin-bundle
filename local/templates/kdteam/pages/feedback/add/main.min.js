var data={id_city:"0",id_compani:"0",head:"0",text:"0",star:"0",letter:"0",kpp:"0",name_user_no_Authorized:""};function delete_cookie(e){var t=new Date;t.setTime(t.getTime()-1),document.cookie=e+="=; expires="+t.toGMTString()}function getCookie(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}$(".star").click(function(){data.star=$(this).attr("data-value")}),$(document).ready(function(){$(document).on("click","#search_result li",function(){$("#referal").val($(this).text()),$("#search_result").fadeOut()}),$(document).on("click","#referal",function(){$("#search_result").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal").has(e.target).length&&$("#search_result").fadeOut()}),$(document).on("click","#search_result_hospital li",function(){$("#referal_two").val($(this).text()),$("#search_result_hospital").fadeOut()}),$(document).on("click","#referal_two",function(){$("#search_result_hospital").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal_two").has(e.target).length&&$("#search_result_hospital").fadeOut()}),$("#referal").on("keyup",function(){var e=$(this);""==e.val()&&(e.attr("data-id_region",""),$(".hospital").each(function(){$(this).remove()}),$("#hospital").remove(),$("#referal_two").val(""),$("#referal_two").attr("data-id_region","")),$("#search_result").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_region.php",{name_city:e.val()},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".region").each(function(){$(this).remove()}),"error_region"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result").append('<li class="error_region" >Регион не найден</li>')):$("#search_result").append('<li class="error_region" >Регион не найден</li>'):setTimeout(function(){$("#search_result").append(e)},100)})},500))}),$(document).on("click",".region",function(){let e=$(this).attr("value");$("#referal").attr("data-id_region",e),$("#referal").attr("data-region_check","check"),$("#referal_two").attr("data-id_region","0"),$("#referal_two").attr("data-id_region_kpp","0"),$("#referal_two").val(""),$.post("/ajax/personal-cabinet/search_company.php",{region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),setTimeout(function(){$("#search_result_hospital").append(e)},100)})}),$(document).on("click",".hospital",function(){let e=$(this).attr("value"),t=$(this).attr("data-kpp"),a=$(this).text();$("#referal_two").val(a),$("#referal_two").attr("data-id_region",e),$("#referal_two").attr("data-id_region_kpp",t),$("#referal_two").attr("data-region_check","check")}),$("#referal_two").on("keyup",function(){var e=$(this);""==e.val()&&e.attr("data-id_region",""),$("#search_result_hospital").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_company.php",{name_hospital:e.val(),region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),"error_company"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):($("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):setTimeout(function(){$("#search_result_hospital").append(e)},100)})},500))}),$(document).on("click",".hospital",function(){let e=$(this).attr("value"),t=$(this).text();$("#referal_two").val(t),$("#referal_two").attr("data-id_region",e),$("#referal_two").attr("data-region_check","check")});var e={user_Authorized:function(e){let t=$("#referal").attr("data-id_region");""==t||null==t?($("#referal").after('<span class="label danger"  >Выберите регион</span>'),this.empty_field.push("error")):data.id_city=t;let a=$("#referal_two").attr("data-id_region");if(""===a||void 0===a||"0"===a)$("#referal_two").after('<span class="label danger"  >Выберите компанию</span>'),this.empty_field.push("error");else{let e=$("#referal_two").attr("data-id_region_kpp");data.kpp=e,data.id_compani=a}data.head=e[0].value,data.text=e[1].value,0===data.id_city&&($("[data-select=city]").next().css({display:"block"}),this.empty_field.push("city")),0===data.id_compani&&($("[data-select=company]").next().css({display:"block"}),this.empty_field.push("company")),void 0!==getCookie("letter")&&(data.letter="1")},user_no_Authorized:function(e){let t=$("#referal").attr("data-id_region");""==t||null==t?($("#referal").after('<span class="label danger"  >Выберите регион</span>'),this.empty_field.push("error")):data.id_city=t;let a=$("#referal_two").attr("data-id_region");if(""===a||void 0===a||"0"===a)$("#referal_two").after('<span class="label danger"  >Выберите компанию</span>'),this.empty_field.push("error");else{let e=$("#referal_two").attr("data-id_region_kpp");data.kpp=e,data.id_compani=a}data.name_user_no_Authorized=e[0].value,data.head=e[1].value,data.text=e[2].value,0===data.id_city&&($("[data-select=city]").next().css({display:"block"}),this.empty_field.push("city")),0===data.id_compani&&($("[data-select=company]").next().css({display:"block"}),this.empty_field.push("company")),void 0!==getCookie("letter")&&(data.letter="1")},empty_field:[],send_data:function(e){console.log(e),$.ajax({url:"/ajax/add_reviews.php",type:"POST",data:e,dataType:"html",beforeSend:function(){delete_cookie("letter")}}).done(function(e){1==e&&$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup" >Ваш отзыв успешно отправлен</div>',type:"inline"},callbacks:{afterClose:function(){document.location.reload(!0)}}})})}};$("#form-comments").validator().on("submit",function(t){t.preventDefault();var a=$("#form-comments").serializeArray();$(".header__r_auth_login").length>0&&$(".header__r_auth_reg").length>0?(e.user_no_Authorized(a),0===e.empty_field.length&&e.send_data(data)):(e.user_Authorized(a),0===e.empty_field.length&&e.send_data(data))})});