var fd=new FormData,data={id_city:"0"};$(document).ready(function(){$(document).on("click","#search_result li",function(){$("#referal").val($(this).text()),$("#search_result").fadeOut()}),$(document).on("click","#referal",function(){$("#search_result").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal").has(e.target).length&&$("#search_result").fadeOut()}),$(document).on("click","#search_result_hospital li",function(){$("#referal_two").val($(this).text()),$("#search_result_hospital").fadeOut()}),$(document).on("click","#referal_two",function(){$("#search_result_hospital").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal_two").has(e.target).length&&$("#search_result_hospital").fadeOut()}),$("#referal").on("keyup",function(){var e=$(this);""==e.val()&&(e.attr("data-id_region",""),$(".hospital").each(function(){$(this).remove()}),$("#hospital").remove(),$("#referal_two").val(""),$("#referal_two").attr("data-id_region","")),$("#search_result").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_region.php",{name_city:e.val()},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".region").each(function(){$(this).remove()}),"error_region"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result").append('<li class="error_region" >Регион не найден</li>')):$("#search_result").append('<li class="error_region" >Регион не найден</li>'):setTimeout(function(){$("#search_result").append(e)},100)})},500))}),$(document).on("click",".region",function(){$(".search-second").css({"pointer-events":"inherit"});let e=$(this).attr("value");$("#referal").attr("data-id_region",e),$("#referal").attr("data-region_check","check"),$("#referal_two").val(""),$.post("/ajax/personal-cabinet/search_company.php",{region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),setTimeout(function(){$("#search_result_hospital").append(e)},100)})}),$(document).on("click",".hospital",function(){let e=$(this).attr("value"),a=$(this).text();$("#referal_two").val(a),$("#referal_two").attr("data-id_region",e),$("#referal_two").attr("data-region_check","check")}),$("#referal_two").on("keyup",function(){var e=$(this);""==e.val()&&e.attr("data-id_region",""),$("#search_result_hospital").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_company.php",{name_hospital:e.val(),region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),"error_company"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):($("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):(console.log("2323"),setTimeout(function(){$("#search_result_hospital").append(e)},100))})},500))}),$("#change-data").click(function(){0==$(this).hasClass("click")?($(this).addClass("click"),$("#true_data_person").css({display:"none"}),$("#for_change_person").css({display:"block"}),$("#change-data").text("Отменить редактирование")):($(this).removeClass("click"),$("#true_data_person").css({display:"block"}),$("#for_change_person").css({display:"none"}),$("#change-data").text("Редактировать данные"))}),$("[name=personal_phone]").mask("+7(000)000-00-00")}),$("#save_data").click(function(e){e.preventDefault();var a=[],r=$("#form_change_data").serializeArray(),t=$(".input_file");if(null!=t.prop("files")[0]){t.prop("files")[0].size>10485760&&(a.push("error"),$(".block-error-label_size").css({display:"block"}),a.push("error"));var n=t.prop("files")[0].type;-1==(n=n.split("/")[1]).search("jpeg")&&-1==n.search("pjpeg")&&-1==n.search("png")&&($(".block-error-label_format").css({display:"block"}),a.push("error"))}let o=$("#referal").attr("data-id_region");console.log(o),""==o&&null==o&&"0"==o||fd.append("town",o);let l=$("#referal_two").attr("data-id_region");""==l&&null==l&&"0"==o||fd.append("id_company",l),r[5].value.length>16?($("[name=uf_insurance_policy]").after(' <span class="label danger  error-policy-max "  >Введен длинный номер полиса</span>'),a.push("error")):r[5].value.length<16&&($("[name=uf_insurance_policy]").after('<span class="label danger  error-policy-min "  >Введен короткий номер полиса</span>'),a.push("error")),r[3].value.length<16&&($("[name=personal_phone]").after('<span class="label danger  error-personal_phone "  >Введен короткий номер телефона</span>'),a.push("error")),r[0].value.length<2&&($("[name=name]").after('<span class="label danger  error-name "  >Введите имя</span>'),a.push("error")),r[1].value.length<2&&($("[name=last_name]").after('<span class="label danger  error-last_name "  >Введите фамилию</span>'),a.push("error")),r[2].value.length<2&&($("[name=second_name]").after('<span class="label danger  error-second_name "  >Введите отчество</span>'),a.push("error")),r[4].value.length<2&&($("[name=email]").after('<span class="label danger  error-email "  >Введите эмеил</span>'),a.push("error")),fd.append("import_file",t.prop("files")[0]),fd.append("name",r[0].value),fd.append("last_name",r[1].value),fd.append("second_name",r[2].value),fd.append("personal_phone",r[3].value),fd.append("email",r[4].value),fd.append("uf_insurance_policy",r[5].value),0==a.length&&$.ajax({url:"/ajax/change_data_user.php",type:"POST",data:fd,processData:!1,contentType:!1,beforeSend:function(){},success:function(e){"1"==e&&window.location.reload(),"Пользователь с таким эмейлом уже есть"==e&&$(".input_email").after('<p class="danger">Пользователь с таким эмейлом уже есть</p>')}}).done(function(e){})}),$(document).ready(function(){for(var e=document.querySelectorAll(".file-input"),a=0,r=e.length;a<r;a++)t(e[a]);function t(e){const a=e.querySelector('[type="file"]'),r=e.querySelector("[data-js-label]");a.onchange=a.onmouseout=function(){if(a.value){var t=a.value.replace(/^.*[\\\/]/,"");e.className+=" -chosen",r.innerText=t}}}});