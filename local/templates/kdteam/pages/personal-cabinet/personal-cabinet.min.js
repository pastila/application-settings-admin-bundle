var fd=new FormData,data={id_city:"0"};function cancel(e){$(document).on("click","#cancel_edit_"+e,function(){location.reload()})}function save(e){$(document).on("click","#save_edit_"+e,function(t){let a=$("#hospital_input_"+e).attr("data-id_hospital");$form=document.getElementById("edit_children_form_"+e),$form.checkValidity()&&$.post("/ajax/add_children.php",{name:$("#children_name_add_"+e).val(),surname:$("#children_last_name_add_"+e).val(),patronymic:$("#children_second_name_add_"+e).val(),policy:$("#child_policy_add_"+e).val(),hospital:a,birthday:$("#children_birthday_add_"+e).val(),id:e},function(t){"error"===t?$(".error_search-js_"+e).css("display","block"):"success"===t&&$.post("/ajax/cur_children.php",function(e){location.reload()})},"html")})}function search_region(){$(document).on("click","#search_result_region li",function(){$("#region_input").val($(this).text()),$("#search_result_region").fadeOut()}),$(document).on("click","#region_input",function(){$("#search_result_region").css("display","block")}),$(document).mouseup(function(e){0===$("#region_input").has(e.target).length&&$("#search_result_region").fadeOut()}),$(document).on("click",".region-js",function(){let e=$(this).attr("value"),t=$("#hospitals");$.post("/ajax/choice_hospital.php",{id:e},function(e){$(t).html(e),search_hospital()},"html")})}function search_region_edit(e){$(document).on("click","#search_result_region"+e+" li",function(){$("#region_input_"+e).val($(this).text()),$("#search_result_region_"+e).fadeOut()}),$(document).on("click","#region_input_"+e,function(){$("#search_result_region_"+e).css("display","block")}),$(document).mouseup(function(t){0===$("#region_input_"+e).has(t.target).length&&$("#search_result_region_"+e).fadeOut()}),$(document).on("click",".region-js_"+e,function(){let t=$(this).attr("value"),a=$("#hospitals_"+e);$.post("/ajax/choice_hospital_edit.php",{id:t,el:e},function(t){$(a).html(t),search_hospital_edit(e)},"html")})}function search_hospital_edit(e){$(document).on("click","#search_result_hospital_"+e+" li",function(){$("#hospital_input_"+e).val($(this).text()),$("#hospital_input_"+e).attr("data-id_hospital",$(this).attr("value")),$("#search_result_hospital_"+e).fadeOut()}),$(document).on("click","#hospital_input_"+e,function(){$("#search_result_hospital_"+e).css("display","block")}),$(document).mouseup(function(t){0===$("#hospital_input_"+e).has(t.target).length&&$("#search_result_hospital_"+e).fadeOut()}),keyup_region_edit(e),keyup_hospital_edit($("#region_input_"+e).attr("data-id_region"),e)}function search_hospital(){$(document).on("click","#search_result_hospital_down li",function(){$("#hospital_input").val($(this).text()),$("#hospital_input").attr("data-id_hospital",$(this).attr("value")),$("#search_result_hospital_down").fadeOut()}),$(document).on("click","#hospital_input",function(){$("#search_result_hospital_down").css("display","block")}),$(document).mouseup(function(e){0===$("#hospital_input").has(e.target).length&&$("#search_result_hospital_down").fadeOut()}),keyup_region(),keyup_hospital($("#region_input").attr("data-id_region"))}function keyup_region_edit(e){$("#region_input_"+e).on("keyup",function(){var t=$(this);clearTimeout(t.data("timer")),t.data("timer",setTimeout(function(){t.removeData("timer"),$("#search_result_region_"+e).css("display","block"),$.post("/ajax/smart_search_region_edit.php",{name_city:t.val(),el:e},function(t){0!=$(".error_region_"+e).length&&$(".error_region_"+e).remove(),$(".region-js_"+e).each(function(){$(this).remove()}),"error_region"==t?0!=$(".error_region_"+e).length?($(".error_region_"+e).remove(),$("#search_result_region_"+e).append('<li class="error_region_'+e+'">Регион не найден</li>')):$("#search_result_region_"+e).append('<li class="error_region_'+e+'">Регион не найден</li>'):(setTimeout(function(){$("#search_result_region_"+e).append(t)},100),$(document).on("click",".region-js_"+e,function(){let t=$(this).attr("value"),a=$(this).text();$("#region_input_"+e).val(a),$("#region_input_"+e).attr("data-id_region",e);let r=$("#hospitals_"+e);$.ajax({dataType:"html",url:"/ajax/choice_hospital_edit.php",type:"POST",data:{id:t,el:e},beforeSend:function(){},success:function(t){$(r).html(t),search_hospital_edit(e),keyup_hospital_edit($("#region_input_"+e).attr("data-id_region"),e)}}).done(function(e){})}))})},500))})}function keyup_region(){$("#region_input").on("keyup",function(){var e=$(this);clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$("#search_result_region").css("display","block"),$.post("/ajax/smart_search_region.php",{name_city:e.val()},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".region-js").each(function(){$(this).remove()}),"error_region"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result_region").append('<li class="error_region">Регион не найден</li>')):$("#search_result_region").append('<li class="error_region">Регион не найден</li>'):(setTimeout(function(){$("#search_result_region").append(e)},100),$(document).on("click",".region-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#region_input").val(t),$("#region_input").attr("data-id_region",e);let a=$("#hospitals");$.ajax({dataType:"html",url:"/ajax/choice_hospital.php",type:"POST",data:{id:e},beforeSend:function(){},success:function(e){$(a).html(e),search_hospital(),keyup_hospital($("#region_input").attr("data-id_region"))}}).done(function(e){})}))})},500))})}function keyup_hospital(e){$("#hospital_input").on("keyup",function(){var t=$(this);clearTimeout(t.data("timer")),t.data("timer",setTimeout(function(){t.removeData("timer"),$("#search_result_hospital_down").css("display","block"),$.post("/ajax/smart_search_hosp.php",{name_hospital:t.val(),region_id:e},function(e){0!=$(".error_hospital").length&&$(".error_hospital").remove(),$(".hospital-js").each(function(){$(this).remove()}),"error_hospital"==e?0!=$(".error_hospital").length?($(".error_hospital").remove(),$("#search_result_hospital_down").append('<li class="error_region error_hospital">Компания не найдена</li>')):$("#search_result_hospital_down").append('<li class="error_region error_hospital">Компания не найдена</li>'):(setTimeout(function(){$("#search_result_hospital_down").append(e)},100),$(document).on("click",".hospital-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#hospital_input").val(t),$("#hospital_input").attr("data-id_hospital",e)}))})},500))})}function keyup_hospital_edit(e,t){$("#hospital_input_"+t).on("keyup",function(){var a=$(this);clearTimeout(a.data("timer")),a.data("timer",setTimeout(function(){a.removeData("timer"),$("#search_result_hospital_"+t).css("display","block"),$.post("/ajax/smart_search_hosp_edit.php",{name_hospital:a.val(),region_id:e,el:t},function(e){0!=$(".error_hospital_"+t).length&&$(".error_hospital_"+t).remove(),$(".hospital-js_"+t).each(function(){$(this).remove()}),"error_hospital"==e?0!=$(".error_hospital_"+t).length?($(".error_hospital_"+t).remove(),$("#search_result_hospital_"+t).append('<li class="error_region error_hospital_'+t+'">Компания не найдена</li>')):$("#search_result_hospital_"+t).append('<li class="error_region error_hospital_'+t+'">Компания не найдена</li>'):(setTimeout(function(){$("#search_result_hospital_"+t).append(e)},100),$(document).on("click",".hospital-js_"+t,function(){let e=$(this).attr("value"),t=$(this).text();$("#hospital_input_"+e).val(t),$("#hospital_input_"+e).attr("data-id_hospital",e)}))})},500))})}$(document).ready(function(){$(document).on("click","#search_result li",function(){$("#referal").val($(this).text()),$("#search_result").fadeOut()}),$(document).on("click","#referal",function(){$("#search_result").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal").has(e.target).length&&$("#search_result").fadeOut()}),$(document).on("click","#search_result_hospital li",function(){$("#referal_two").val($(this).text()),$("#search_result_hospital").fadeOut()}),$(document).on("click","#referal_two",function(){$("#search_result_hospital").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal_two").has(e.target).length&&$("#search_result_hospital").fadeOut()}),$("#referal").on("keyup",function(){var e=$(this);""==e.val()&&(e.attr("data-id_region",""),$(".hospital").each(function(){$(this).remove()}),$("#hospital").remove(),$("#referal_two").val(""),$("#referal_two").attr("data-id_region","")),$("#search_result").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_region.php",{name_city:e.val()},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".region").each(function(){$(this).remove()}),"error_region"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result").append('<li class="error_region" >Регион не найден</li>')):$("#search_result").append('<li class="error_region" >Регион не найден</li>'):setTimeout(function(){$("#search_result").append(e)},100)})},500))}),$(document).on("click",".region",function(){$(".search-second").css({"pointer-events":"inherit"});let e=$(this).attr("value");$("#referal").attr("data-id_region",e),$("#referal").attr("data-region_check","check"),$("#referal_two").val(""),$.post("/ajax/personal-cabinet/search_company.php",{region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),setTimeout(function(){$("#search_result_hospital").append(e)},100)})}),$(document).on("click",".hospital",function(){let e=$(this).attr("value"),t=$(this).text();$("#referal_two").val(t),$("#referal_two").attr("data-id_region",e),$("#referal_two").attr("data-region_check","check")}),$("#referal_two").on("keyup",function(){var e=$(this);""==e.val()&&e.attr("data-id_region",""),$("#search_result_hospital").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/personal-cabinet/search_company.php",{name_hospital:e.val(),region_id:$("#referal").attr("data-id_region")},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),"error_company"==e?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):($("#search_result_hospital").append('<li class="error_region" >Компания не найдена</li>'),$(".hospital-empty").remove()):setTimeout(function(){$("#search_result_hospital").append(e)},100)})},500))}),$("#change-data").click(function(){0==$(this).hasClass("click")?($(this).addClass("click"),$("#true_data_person").css({display:"none"}),$("#for_change_person").css({display:"block"}),$("#change-data").text("Отменить редактирование")):($(this).removeClass("click"),$("#true_data_person").css({display:"block"}),$("#for_change_person").css({display:"none"}),$("#change-data").text("Редактировать данные"))}),$("[name=personal_phone]").mask("+7(000)000-00-00"),$("#save_data").click(function(e){e.preventDefault();var t=[],a=$("#form_change_data").serializeArray();$(".input_file");a[4].value.length>16?($("[name=uf_insurance_policy]").after(' <span class="label danger  error-policy-max "  >Введен длинный номер полиса</span>'),t.push("error")):a[4].value.length<16&&($("[name=uf_insurance_policy]").after('<span class="label danger  error-policy-min "  >Введен короткий номер полиса</span>'),t.push("error"));let r=$("#referal").attr("data-id_region");if(""!=r||null!=r||"0"!=r){fd.append("town",r);let e=$("#referal_two").attr("data-id_region");""==e&&null==e&&"0"==r||fd.append("id_company",e)}a[1].value.length<2&&($("[name=name]").after('<span class="label danger  error-name "  >Введите имя</span>'),t.push("error")),a[0].value.length<2&&($("[name=last_name]").after('<span class="label danger  error-last_name "  >Введите фамилию</span>'),t.push("error")),a[2].value.length<2&&($("[name=second_name]").after('<span class="label danger  error-second_name "  >Введите отчество</span>'),t.push("error")),a[3].value.length<2&&($("[name=email]").after('<span class="label danger  error-email "  >Введите эмеил</span>'),t.push("error")),fd.append("name",a[1].value),fd.append("last_name",a[0].value),fd.append("second_name",a[2].value),fd.append("email",a[3].value),fd.append("uf_insurance_policy",a[4].value),0==t.length&&$.ajax({url:"/ajax/personal-cabinet/change_data_user.php",type:"POST",data:fd,processData:!1,contentType:!1,beforeSend:function(){},success:function(e){"1"==e&&window.location.reload(),"Пользователь с таким эмейлом уже есть"==e&&$(".input_email").after('<p class="danger">Пользователь с таким эмейлом уже есть</p>')}}).done(function(e){})});for(var e=document.querySelectorAll(".file-input"),t=0,a=e.length;t<a;t++)r(e[t]);function r(e){const t=e.querySelector('[type="file"]'),a=e.querySelector("[data-js-label]");t.onchange=t.onmouseout=function(){if(t.value){var r=t.value.replace(/^.*[\\\/]/,"");e.className+=" -chosen",a.innerText=r}}}$(document).on("click","#add_children_btn",function(){search_region(),keyup_region(),$("#add_children").css("display","block"),$("#add_children_btn").css("display","none")}),$(document).on("click","#cancel",function(){$("#add_children").css("display","none"),$("#add_children_btn").css("display","inline-flex"),$("#add_children_form")[0].reset()}),$(document).on("click","#save_children",function(e){let t=$("#hospital_input").attr("data-id_hospital");$form=document.getElementById("add_children_form"),$form.checkValidity()&&$.post("/ajax/add_children.php",{name:$("#children_name_add").val(),surname:$("#children_last_name_add").val(),patronymic:$("#children_second_name_add").val(),town:$(".id_region").val(),policy:$("#child_policy_add").val(),hospital:t,birthday:$("#children_birthday_add").val()},function(e){"error"===e?$(".error_search-js").css("display","block"):"success"===e&&($("#add_children").css("display","none"),$("#add_children_btn").css("display","flex"),$("#add_children_form")[0].reset(),$.post("/ajax/cur_children.php",function(e){$("#cur_children").html(e)}))},"html")}),$(document).on("click",".del_js",function(){let e=$(this).attr("id").split("_"),t=$("#element_"+e[1]);$.ajax({url:"/ajax/del_child.php",data:{ID:e[1]},type:"post",success:function(){t.remove()}})}),$(document).on("click",".edit_js",function(){let e=$(this).attr("id").split("_");$("#element_"+e[1]);$("#edit_children_"+e[1]).css("display","block"),$("#element_"+e[1]).css("display","none"),search_region_edit(e[1]),keyup_region_edit(e[1]),search_hospital_edit(e[1]),cancel(e[1]),save(e[1]),keyup_hospital_edit($("#region_input_"+e[1]).attr("data-id_region"),e[1])})});