function search_class(){$(document).on("click","#search_result_class li",function(){$("#class_input").val($(this).text()),$("#search_result_class").fadeOut()}),$(document).on("click","#class_input",function(){$("#search_result_class").css("display","block")}),$(document).mouseup(function(e){0===$("#class_input").has(e.target).length&&$("#search_result_class").fadeOut()}),$(document).on("click",".class-js",function(){let e=$(this).attr("value"),t=$("#grid");$.post("/ajax/main_form_oms.php",{id:e},function(e){$(t).html(e),search_group()},"html")})}function search_group(){$(document).on("click","#search_result_group li",function(){$("#group_input").val($(this).text()),$("#search_result_group").fadeOut()}),$(document).on("click","#group_input",function(){$("#search_result_group").css("display","block")}),$(document).mouseup(function(e){0===$("#group_input").has(e.target).length&&$("#search_result_group").fadeOut()}),$(document).on("click",".group-js",function(){let e=$(this).attr("value"),t=$("#grid");$.post("/ajax/main_form_oms.php",{id:e},function(e){$(t).html(e),console.log("stage 2"),search_subgroup()},"html")}),keyup_class(),keyup_group($("#class_input").attr("data-id_class"))}function search_subgroup(){$(document).on("click","#search_result_subgroup li",function(){$("#subgroup_input").val($(this).text()),$("#search_result_subgroup").fadeOut()}),$(document).on("click","#subgroup_input",function(){$("#search_result_subgroup").css("display","block")}),$(document).mouseup(function(e){0===$("#subgroup_input").has(e.target).length&&$("#search_result_subgroup").fadeOut()}),$(document).on("click",".subgroup-js",function(){let e=$(this).attr("value"),t=$("#grid");$.post("/ajax/main_form_oms.php",{id:e},function(e){$(t).html(e),console.log("stage 3"),search_diagnoz()},"html")}),keyup_class(),keyup_group($("#class_input").attr("data-id_class")),keyup_subgroup($("#group_input").attr("data-id_group"))}function search_diagnoz(){$(document).on("click","#search_result_diagnoz li",function(){$("#diagnoz_input").val($(this).text()),$("#diagnoz_input").attr("data-id_diagnoz",$(this).attr("value")),$("#search_result_diagnoz").fadeOut()}),$(document).on("click","#diagnoz_input",function(){$("#search_result_diagnoz").css("display","block")}),$(document).mouseup(function(e){0===$("#diagnoz_input").has(e.target).length&&$("#search_result_diagnoz").fadeOut()}),keyup_class(),keyup_group($("#class_input").attr("data-id_class")),keyup_subgroup($("#group_input").attr("data-id_group")),keyup_diagnoz($("#subgroup_input").attr("data-id_subgroup"))}function keyup_class(){console.log("keyup_class"),$("#class_input").on("keyup",function(){var e=$(this);$("#search_result_class").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/smart_search_class.php",{name:e.val()},function(e){console.log("search"),0!=$(".error_class").length&&$(".error_class").remove(),$(".class-js").each(function(){$(this).remove()}),"error_class"==e?0!=$(".error_class").length?($(".error_class").remove(),$("#search_result_class").append('<li class="error_class">Класс не найден</li>')):$("#search_result_class").append('<li class="error_class">Класс не найден</li>'):(setTimeout(function(){$("#search_result_class").append(e)},100),$(document).on("click",".class-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#class_input").val(t),$("#class_input").attr("data-id_class",e);let a=$("#grid");$.ajax({dataType:"html",url:"/ajax/main_form_oms.php",type:"POST",data:{id:e},beforeSend:function(){},success:function(e){$(a).html(e),keyup_class(),keyup_group($("#class_input").attr("data-id_class"))}}).done(function(e){})}))})},500))})}function keyup_group(e){console.log("keyup_group"),$("#group_input").on("keyup",function(){var t=$(this);$("#search_result_group").css({display:"block"}),clearTimeout(t.data("timer")),t.data("timer",setTimeout(function(){t.removeData("timer"),$.post("/ajax/smart_search_group.php",{name:t.val(),id:e},function(e){0!=$(".error_group").length&&$(".error_group").remove(),$(".group-js").each(function(){$(this).remove()}),"error_group"==e?0!=$(".error_group").length?($(".error_group").remove(),$("#search_result_group").append('<li class="error_group">Группа не найдена</li>')):$("#search_result_group").append('<li class="error_group">Группа не найдена</li>'):(setTimeout(function(){$("#search_result_group").append(e)},100),$(document).on("click",".group-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#group_input").val(t),$("#group_input").attr("data-id_group",e);let a=$("#grid");$.ajax({dataType:"html",url:"/ajax/main_form_oms.php",type:"POST",data:{id:e},beforeSend:function(){},success:function(e){$(a).html(e),keyup_class(),keyup_group($("#class_input").attr("data-id_class")),keyup_subgroup($("#group_input").attr("data-id_group"))}}).done(function(e){})}))})},500))})}function keyup_subgroup(e){console.log("keyup_subgroup"),$("#subgroup_input").on("keyup",function(){var t=$(this);$("#search_result_subgroup").css({display:"block"}),clearTimeout(t.data("timer")),t.data("timer",setTimeout(function(){t.removeData("timer"),$.post("/ajax/smart_search_subgroup.php",{name:t.val(),id:e},function(e){0!=$(".error_subgroup").length&&$(".error_subgroup").remove(),$(".subgroup-js").each(function(){$(this).remove()}),"error_subgroup"==e?0!=$(".error_subgroup").length?($(".error_subgroup").remove(),$("#search_result_subgroup").append('<li class="error_subgroup">Подгруппа не найдена</li>')):$("#search_result_subgroup").append('<li class="error_subgroup">Подгруппа не найдена</li>'):(setTimeout(function(){$("#search_result_subgroup").append(e)},100),$(document).on("click",".subgroup-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#subgroup_input").val(t),$("#subgroup_input").attr("data-id_subgroup",e);let a=$("#grid");$.ajax({dataType:"html",url:"/ajax/main_form_oms.php",type:"POST",data:{id:e},beforeSend:function(){},success:function(e){$(a).html(e),keyup_class(),keyup_group($("#class_input").attr("data-id_class")),keyup_subgroup($("#group_input").attr("data-id_group")),keyup_diagnoz($("#subgroup_input").attr("data-id_subgroup"))}}).done(function(e){})}))})},500))})}function keyup_diagnoz(e){console.log("keyup_diagnoz"),$("#diagnoz_input").on("keyup",function(){var t=$(this);$("#search_result_diagnoz").css({display:"block"}),clearTimeout(t.data("timer")),t.data("timer",setTimeout(function(){t.removeData("timer"),$.post("/ajax/smart_search_diagnoz.php",{name:t.val(),id:e},function(e){0!=$(".error_diagnoz").length&&$(".error_diagnoz").remove(),$(".diagnoz-js").each(function(){$(this).remove()}),"error_diagnoz"==e?0!=$(".error_diagnoz").length?($(".error_diagnoz").remove(),$("#search_result_diagnoz").append('<li class="error_diagnoz">Диагноз не найден</li>')):$("#search_result_diagnoz").append('<li class="error_diagnoz">Диагноз не найден</li>'):(setTimeout(function(){$("#search_result_diagnoz").append(e)},100),$(document).on("click",".diagnoz-js",function(){let e=$(this).attr("value"),t=$(this).text();$("#diagnoz_input").val(t),$("#diagnoz_input").attr("data-id_diagnoz",e)}))})},500))})}function search_diagnoz_global(){$(document).on("click","#search_diagnoz_global li",function(){$("#search_diagnoz_input").val($(this).text()),$("#search_diagnoz_input").attr("data-value",$(this).attr("value")),$("#search_diagnoz_global").fadeOut()}),$(document).on("click","#search_diagnoz_input",function(){$("#search_diagnoz_global").css("display","block")}),$(document).mouseup(function(e){0===$("#search_diagnoz_input").has(e.target).length&&$("#search_diagnoz_global").fadeOut()})}function keyup_diagnoz_global(){$("#search_diagnoz_input").on("keyup",function(){var e=$(this);clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$("#search_diagnoz_global").css("display","block"),$.post("/ajax/forma-obrashenija/keyup_diagnoz_global.php",{name:e.val()},function(e){0!=$(".error_diagnoz").length&&$(".error_diagnoz").remove(),$(".diagnoz_search_js").each(function(){$(this).remove()}),console.log(e),"error"==e?0!=$(".error_diagnoz").length?($(".error_diagnoz").remove(),$("#search_diagnoz_global").append('<li class="error_diagnoz">Диагноз не найден</li>')):$("#search_diagnoz_global").append('<li class="error_diagnoz">Диагноз не найден</li>'):(setTimeout(function(){$("#search_diagnoz_global").append(e)},100),$(document).on("click",".diagnoz_search_js",function(){$("#search_diagnoz_input").val($(this).text()),$("#search_diagnoz_input").attr("data-value",$(this).attr("value"))}))})},500))})}$(document).ready(function(){function e(){$("#referal_forma").on("keyup",function(){var a=$(this);$("#search_result").css({display:"block"});""==a.val()&&($("#region_name").text("НЕ ВЫБРАНО"),a.attr("data-id_region","")),clearTimeout(a.data("timer")),a.data("timer",setTimeout(function(){a.removeData("timer"),$.post("/ajax/smart_search.php",{name_city:a.val()},function(a){0!=$(".error_region").length&&$(".error_region").remove(),$(".region").each(function(){$(this).remove()}),"error_region"==a?0!=$(".error_region").length?($(".error_region").remove(),$("#search_result").append('<li class="error_region" >Регион не найден</li>')):$("#search_result").append('<li class="error_region" >Регион не найден</li>'):(setTimeout(function(){$("#search_result").append(a)},100),$(document).on("click",".region",function(){let a=$(this).attr("value"),o=$(this).text();$("#referal_forma").val(o),$("#referal_forma").attr("data-id_region",a),$("#referal_forma").attr("data-region_check","check"),$("#region_name").text(o);let r=$("#hospitals");$.ajax({dataType:"html",url:"/ajax/form_hospitals.php",type:"POST",data:{id:a,year:$("#selected_year").val()},beforeSend:function(){},success:function(a){$(r).html(a),$("#region_name").text(o),$("#hosptital_name").html("Не выбрано"),t(),e()}}).done(function(e){})}))})},500))})}function t(){$(document).on("click",".hospital",function(){let e=$(this).attr("value"),t=$(this).text(),a=$(this).attr("data-name-boss"),o=$(this).attr("data-street");$("#referal_two_forma").val(t),$("#referal_two_forma").attr("data-id_region",e),$("#referal_two_forma").attr("data-region_check","check"),$("#hosptital_name").text(t),$("#street_name").text(o),$("#boss_name").text(a)}),$("#referal_two_forma").on("keyup",function(){var e=$(this);""==e.val()&&($("#hosptital_name").text("НЕ ВЫБРАНО"),e.attr("data-id_region",""),$("#street_name").text("НЕ ВЫБРАНО"),$("#boss_name").text("НЕ ВЫБРАНО")),$("#search_result_hospital").css({display:"block"}),clearTimeout(e.data("timer")),e.data("timer",setTimeout(function(){e.removeData("timer"),$.post("/ajax/smart_search_hospital.php",{name_hospital:e.val(),region_id:$("#referal_forma").attr("data-id_region"),year:$("#selected_year").val()},function(e){0!=$(".error_region").length&&$(".error_region").remove(),$(".hospital").each(function(){$(this).remove()}),$(".hospital-empty").remove(),"error_hospital"==e?(keyup_class(),0!=$(".error_region").length?($(".error_region").remove(),$("#search_result_hospital").append('<li class="error_region" >Больница не найдена</li>'),$(".hospital-empty").remove()):($("#search_result_hospital").append('<li class="error_region" >Больница не найдена</li>'),$(".hospital-empty").remove())):(setTimeout(function(){$("#search_result_hospital").append(e)},100),$(document).on("click",".hospital",function(){let e=$(this).attr("value"),t=$(this).text(),a=$(this).attr("data-name-boss"),o=$(this).attr("data-street");$("#referal_two_forma").val(t),$("#referal_two_forma").attr("data-id_region",e),$("#referal_two_forma").attr("data-region_check","check"),$("#hosptital_name").text(t),$("#street_name").text(o),$("#boss_name").text(a)}))})},500))})}$(".years").click(function(){if(""!=$("#selected_year").val()){var a=$(this).attr("data-year");$("#selected_year").val(a);let o=$("#hospitals");$.ajax({dataType:"html",url:"/ajax/form_hospitals.php",type:"POST",data:{id:""},beforeSend:function(){},success:function(a){$(o).html(a),$("#region_name").html("Не выбрано"),$("#hosptital_name").html("Не выбрано"),$("#street_name").html("Не выбрано"),$("#boss_name").html("Не выбрано"),t(),e()}}).done(function(e){})}else{a=$(this).attr("data-year");$("#selected_year").val(a)}}),e(),search_class(),keyup_class(),search_diagnoz_global(),keyup_diagnoz_global(),$(document).on("click","#search_result li",function(){$("#referal_forma").val($(this).text()),$("#search_result").fadeOut()}),$(document).on("click","#referal_forma",function(){$("#search_result").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal_forma").has(e.target).length&&$("#search_result").fadeOut()}),$(document).on("click","#search_result_hospital li",function(){$("#referal_two_forma").val($(this).text()),$("#search_result_hospital").fadeOut()}),$(document).on("click","#referal_two_forma",function(){$("#search_result_hospital").css({display:"block"})}),$(document).mouseup(function(e){0===$("#referal_two_forma").has(e.target).length&&$("#search_result_hospital").fadeOut()}),$(document).on("click",".region",function(){let a=$(this).attr("value"),o=$(this).text();$("#referal_forma").val(o),$("#referal_forma").attr("data-id_region",a),$("#region_name").text(o),$("#referal_forma").attr("data-region_check","check");let r=$("#hospitals");$.ajax({dataType:"html",url:"/ajax/form_hospitals.php",type:"POST",data:{id:a,year:$("#selected_year").val()},beforeSend:function(){},success:function(a){$(r).html(a),$("#region_name").text(o),$("#hosptital_name").html("Не выбрано"),$("#street_name").html("Не выбрано"),$("#boss_name").html("Не выбрано"),e(),t()}}).done(function(e){})});let a,o=$("#urgent"),r=$("#planned");r.click(function(){r.is(":checked")&&(o.prop("checked",!1),a="Плановое")}),o.click(function(){o.is(":checked")&&(r.prop("checked",!1),a="Неотложное")}),$(document).on("click","#diagnoz_elem",function(){$("#choose_diagnoz_elem").attr("value",this.getAttribute("value"))}),$(document).on("click","#strax-sluchay",function(){let e=[],t=$("#appeal-form"),o=$("#page-title"),r=$("#referal_forma").attr("data-id_region");""!=r&&null!=r||($("#referal_forma").after('<p class="label danger"  >Выберите регион</p>'),e.push("error1"),$(".error_step-card-3").addClass("error_block"));let s=$("#referal_two_forma").attr("data-id_region");if(""!=s&&null!=s||($("#referal_two_forma").after('<p class="label danger"  >Выберите больницу</p>'),e.push("erro2"),$(".error_step-card-3").addClass("error_block")),void 0===$("#search_diagnoz_input").attr("data-value")){var n=$("#class_input").attr("data-id_class");""!=n&&null!=n||($("#class_input").after('<p class="label danger absolute_label">Выберите класс</p>'),e.push("error3"),$(".error_step-card-4").addClass("error_block"));var i=$("#group_input").attr("data-id_group");""!=i&&null!=i||($("#group_input").after('<p class="label danger absolute_label">Выберите группу</p>'),e.push("error4"),$(".error_step-card-4").addClass("error_block"));var l=$("#subgroup_input").attr("data-id_subgroup");""!=l&&null!=l||($("#subgroup_input").after('<p class="label danger absolute_label">Выберите подгруппу</p>'),e.push("error5"),$(".error_step-card-4").addClass("error_block"));var u=$("#diagnoz_input").attr("data-id_diagnoz");""!=u&&null!=u||($("#diagnoz_input").after('<p class="label danger absolute_label">Выберите диагноз</p>'),e.push("error6"),$(".error_step-card-4").addClass("error_block"))}else u=$("#search_diagnoz_input").attr("data-value");let c=[],p=$("#years");$(p).find("input:checked").each(function(){c.push(this.value)}),0==c.length&&($(".wrap-chrckbox:first").after('<p class="label danger"  >Выберите год</p>'),e.push("error7"));let _=[],d=$(".plannet");$(d).find("input:checked").each(function(){_.push(this.value)}),0==_.length&&(d.after('<p class="label danger"  >Не выбранно</p>'),e.push("error8"),$(".error_step-card-1").addClass("error_block")),console.log(e),e.length>0||("Здесь нет моего диагноза"!=$("#choose_diagnoz_elem").val()?1==$(".header__r_auth_reg").length&&0==$(".header__r_auth_reg").attr("data-rigstration")?($(".header__r_auth_reg").trigger("click"),setTimeout(function(){$(".register_before_review").removeClass("hidden")},700)):$.post("/ajax/diagnoz.php",{APPEAL_VALUE:a,YEARS:c,REGION:r,HOSPITAL:s,CLASS:n,GROUP:i,SUBGROUP:l,DIAGNOZ:u},function(e){let a=jQuery.parseJSON(e);$("#strax-sluchay").remove(),"error"!==a?(t.replaceWith(a.DIAGNOZ),o.html(a.FULL_NAME),document.body.scrollTop=document.documentElement.scrollTop=0,$("#generate_form").magnificPopup({type:"ajax",modal:!0,callbacks:{beforeOpen:function(){$(window).width()<700?this.st.focus=!1:this.st.focus="#name"},afterClose:function(){$.post("/ajax/number_calls.php",function(e){$("#number_calls").html(e)},"html")}}})):$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Вы заполнили не все данные</div>',type:"inline"}})},"html"):$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Вы заполнили не все данные</div>',type:"inline"}}))}),$(document).on("click","#option",function(){let e=$(this).attr("value"),t=$(".grid"),a=$(this).attr("id");e&&"option"===a&&$.post("/ajax/main_form_oms.php",{id:e},function(e){$(t).html(e),console.log("stage 1"),update_select()},"html")}),$(document).on("click","#location",function(){let e=$(this).attr("value"),t=$(this).text(),a=$("#hospitals"),o=$("#region_name"),r=$(this).attr("id");e&&"location"===r&&$.post("/ajax/form_hospitals.php",{id:e},function(e){$(a).html(e),$(o).html(t),$("#hosptital_name").html("Не выбрано"),update_hospital_select()},"html")}),$(document).on("click","#hospital",function(){$("#choose_hospital_elem").attr("value",this.getAttribute("value"));let e=$(this).text(),t=$("#hosptital_name");$(t).html(e),"Здесь нет моей больницы"==e?($.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если больницы, в которую вы обратились, в списке нет, значит, она не является участником системы ОМС и не несет обязательств по оказанию помщи по полису ОМС. Случай не страховой.</div>',type:"inline"}}),$("#choose_class").css({"pointer-events":"none"})):$("#choose_class").removeAttr("style")}),$(document).on("click",".error_region",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click",".error_class",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click",".error_group",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click",".error_subgroup",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click",".error_diagnoz",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click","#empty_class",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click","#empty_group",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click","#empty_subgroup",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})}),$(document).on("click","#empty_diagnoz",function(){$.magnificPopup.open({items:{src:'<div class="white-popup custom_styles_popup">Если среди диагнозов вы не нашли свой, значит заболевание не относится к числу тех, что оплачитваются из средства ОМС. Случай не является страховым.</div>',type:"inline"}})})});